#!/bin/bash

echo "๐ ะะฐัะธะฝะฐะตะผ ะดะตะฟะปะพะน DocFinder v2..."

# ะััะฐะฝะพะฒะบะฐ ะธ ัะดะฐะปะตะฝะธะต ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
echo "๐ฆ ะััะฐะฝะพะฒะบะฐ ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ..."
sudo docker stop docfinder_nextjs_1 2>/dev/null || true
sudo docker rm docfinder_nextjs_1 2>/dev/null || true

# ะฃะดะฐะปะตะฝะธะต ััะฐััั ะพะฑัะฐะทะพะฒ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
echo "๐๏ธ ะัะธััะบะฐ ััะฐััั ะพะฑัะฐะทะพะฒ..."
sudo docker system prune -f

# ะกะฑะพัะบะฐ ะธ ะทะฐะฟััะบ ะฝะพะฒัั ะบะพะฝัะตะนะฝะตัะพะฒ
echo "๐จ ะกะฑะพัะบะฐ ะฝะพะฒะพะณะพ ะพะฑัะฐะทะฐ..."
sudo docker-compose build --no-cache

echo "๐ ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ..."
sudo docker-compose up -d

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
echo "โ ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะฐ..."
sudo docker-compose ps

echo "๐ ะะพัะปะตะดะฝะธะต ะปะพะณะธ:"
sudo docker-compose logs --tail=20

echo "๐ ะะตะฟะปะพะน ะทะฐะฒะตััะตะฝ!"
echo "๐ ะกะฐะนั ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั: https://docfinder.kz"
echo "๐ ะะปั ะฟัะพัะผะพััะฐ ะปะพะณะพะฒ: sudo docker-compose logs -f"
